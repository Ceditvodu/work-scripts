<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		.head-holder{
			height: 780px;
		}
		.header-frame{
			width: 960px;
			margin: 0 auto;
			overflow: hidden;
		}
		#slider{
			overflow: hidden;
		}
		.sliderBack{
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			overflow: hidden;
			z-index: -1;
		}
		.sliderCont{
			overflow: hidden;
		}
		.back{
			height: 100%;

		}
		.back .item, .cont .item{
			float: left;
			width: 100%;
			height: 100%;
			-webkit-transition: all 1s ease 0.1s ;
			-o-transition: all 1s ease 0.1s ;
			transition: all 1s ease 0.1s ;
		}
	</style>
</head>
<body>
	<div class="head-holder">
		<div class="header-frame">
			<div class="header-block">
				<div id="slider">
					<div class="sliderBack">
						<div class="back">
							<div width="100%" height="100%" class="item item-1">
								dfdfgd1
							</div>
							<div width="100%" height="100%" class="item item-2">
								<video width="100%" loop muted autoplay>
							        <source src="img/Complete_system_for_private_homes_-_Siedle_Select.mp4" type="video/mp4; codecs="avc1.42E01E, mp4a.40.2"">
						    	</video>
							</div>
							<div width="100%" height="100%" class="item item-3">
								dfgdfg2 dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2dfgdfg2
							</div>
						</div>
					</div>
					<div class="sliderCont">
						<div class="cont">
							<div class="item item-1">
								<a class="fancybox btn-survey" href="#contact">Haluan kartoituksen1</a>
								<strong>Turvaa kotisi - pyydä meidät <span> ilmaiselle</span> kartoituskäynnille</strong>
							</div>
							<div class="item item-2">
								<a class="fancybox btn-survey" href="#contact">Haluan kartoituksen2</a>
								<strong>Turvaa kotisi - pyydä meidät <span> ilmaiselle</span> kartoituskäynnille</strong>
							</div>
							<div class="item item-3">
								<a class="fancybox btn-survey" href="#contact">Haluan kartoituksen3</a>
								<strong>Turvaa kotisi - pyydä meidät <span> ilmaiselle</span> kartoituskäynnille</strong>
							</div>
						</div>	
					</div>
				</div>

			</div>
		</div>
	</div>
	
</body>
</html>
<script>
	
var slider = function(slider){
	this.slider_id = slider;
	this.slider = document.getElementById(this.slider_id);

	this.slider_back = this.slider.getElementsByClassName('back')[0];
	this.slider_cont = this.slider.getElementsByClassName('cont')[0];

	this.back = this.slider_back.getElementsByClassName('item');
	this.cont = this.slider_cont.getElementsByClassName('item');


	this.back_width = window.innerWidth*this.back.length;
	this.cont_width = document.getElementsByClassName('cont')[0].clientWidth*this.cont.length;
	this.cont_item_width = document.getElementsByClassName('cont')[0].clientWidth;

	this.slider_back.style.width = this.back_width+'px';
	this.slider_cont.style.width = this.cont_width+'px';

	this.slide_back_coordinates = new Array();

	for (var i = 0; i < this.back.length; i++) {
		this.back[i].style.width=window.innerWidth+'px';
	};
	for (var i = 0; i < this.cont.length; i++) {
		this.cont[i].style.width=this.cont_item_width+'px';
	};

	if((this.back.length>1)&&(this.cont.length>1)){
		this.arrow_set = this.slider.appendChild(document.createElement('div'));
		this.arrow_set.id = 'arrow_set';

		this.left_arrow = this.arrow_set.appendChild(document.createElement('div'));
		this.right_arrow = this.arrow_set.appendChild(document.createElement('div'));

		this.left_arrow.id = 'left_arrow';
		this.right_arrow.id = 'right_arrow';

		this.left_arrow.style.position = 'absolute';
		this.right_arrow.style.position = 'absolute';
		this.left_arrow.style.height = '50px';
		this.right_arrow.style.height = '50px';
		this.left_arrow.style.width = '50px';
		this.right_arrow.style.width = '50px';
		this.left_arrow.style.top = '50%';
		this.right_arrow.style.top = '50%';
		this.left_arrow.style.backgroundColor = '#ff0000';
		this.right_arrow.style.backgroundColor = '#00ff00';
		this.left_arrow.style.left = '50px';
		this.right_arrow.style.right = '50px';

		this.slide_direction = 'left';

		var slide_back_coordinates = new Array();
		var margin_position = 0;
		var margin_position_index = 0;

		var pause;
	}
	for (var i = 0; i < this.back.length; i++) {
		slide_back_coordinates[i] = window.innerWidth * i;
	};


	if((this.back.length>1)&&(this.cont.length>1)){

		slider_slid_left(margin_position_index,10,3000);
		
	}


	var queue_of_slider = new queue();


	function slider_slid_left(margin_position_index,step_width,pause_time){
		
		pause = setTimeout(function(margin_position_index){
			slide = setInterval(function(){
				margin_position = margin_position - step_width;
				document.getElementsByClassName('back')[0].style.margin = '0 0 0 '+ margin_position + 'px';

				if(margin_position <= (slide_back_coordinates[margin_position_index+1]*(-1))){

					clearInterval(slide);
					newAction();
				}

					console.log(margin_position*(-1))
					console.log('--')
					console.log(slide_back_coordinates[slide_back_coordinates.length-1])
				if((margin_position*(-1))>(slide_back_coordinates[slide_back_coordinates.length]*1)){
					clearInterval(slide);
					//newAction();
				}

			},1,margin_position_index)
		},pause_time,margin_position_index)
	}

	function slider_slid_right(margin_position_index,step_width,pause_time){
		pause = setTimeout(function(margin_position_index){
			slide = setInterval(function(){
				margin_position = margin_position + step_width;
				document.getElementsByClassName('back')[0].style.margin = '0 0 0 '+ margin_position + 'px';

				if(margin_position >= (slide_back_coordinates[margin_position_index]*(1))){
					clearInterval(slide);
					newAction();

				}

			},1, margin_position_index)
		},pause_time, margin_position_index)

	}

	this.left_arrow.onclick = function(){
		clearTimeout(pause);

		queue_of_slider.appendQueueDiraction('left');
		newAction();
	}
	this.right_arrow.onclick = function(){
		clearTimeout(pause);
		queue_of_slider.appendQueueDiraction('right');

		newAction();
	}



	function newAction(){
		if(queue_of_slider.isFull()){
			if(queue_of_slider.getNextAction() == 'left'){

				queue_of_slider.removeIteme();

				if(margin_position_index == slide_back_coordinates.length-1){
					margin_position_index  = 0;
					slider_slid_right(margin_position_index,10,0);	
					margin_position_index  = -1;
				}else{
					slider_slid_left(margin_position_index,10,0);
				}
				//slider_slid_right(margin_position_index,10,0);
				// margin_position_index = margin_position_index+1;


				// if(margin_position_index <= slide_back_coordinates.length-1){
				// 	console.log(margin_position_index+' '+ slide_back_coordinates.length-1);
				// 	margin_position_index  = 0;

				// 	slider_slid_right(margin_position_index,10,0);
				// 	margin_position_index  = -1;
				// }else{
				// 	slider_slid_left(margin_position_index,10,0);
				// }

			}else if(queue_of_slider.getNextAction() == 'right'){
				// deleting item from queue
				queue_of_slider.removeIteme();

				console.log(margin_position_index);
				if(margin_position_index<=0){
					console.log(margin_position_index);
					slider_slid_left(margin_position_index,10,0);

				}
				//margin_position_index = margin_position_index+1;

				//starting right slide without pause
				slider_slid_right(margin_position_index,10,0);

				// if(margin_position_index >= slide_back_coordinates.length-1){
				// 	margin_position_index  = 0;

				// 	slider_slid_left(margin_position_index,10,0);
				// 	margin_position_index  = -1;
				// }else{
				// 	slider_slid_right(margin_position_index,10,0);
				// }

			}
		}else{

			margin_position_index = margin_position_index+1;

			if(margin_position_index >= slide_back_coordinates.length-1){
				margin_position_index  = 0;

				slider_slid_right(margin_position_index,10,3000);
				margin_position_index  = -1;
			}else{
				slider_slid_left(margin_position_index,10,3000);
			}
		}
	}
}

var queue = function(){
	this.queue = new Array();

	this.appendQueueDiraction = function(diraction){
		this.queue[this.queue.length] = diraction;
	}

	this.isFull = function(){
		if(this.queue.length > 0){
			return true;
		}else{
			return false;
		}

	}

	this.getNextAction = function(){
		if (this.queue[0] == 'left') {
			return 'left';
		}else if(this.queue[0] == 'right'){
			return 'right';
		}else{
			return 'nothing';
		}
		
	}
	this.removeIteme = function(){
		this.queue.splice(0);
	}
}

window.onload = function(){
	var s = new slider('slider');
}

</script>